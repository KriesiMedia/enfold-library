function avia_log(a,e){"undefined"!=typeof console&&(void 0===e&&(e="log"),!1===e?console.log(a):(e="AVIA-"+e.toUpperCase(),console.log("["+e+"] "+a)))}function avia_nl2br(a,e){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(e||void 0===e?"<br />":"<br>")+"$2")}function avia_isNumeric(a){var e=typeof a;return("number"===e||"string"===e)&&!isNaN(a-parseFloat(a))}document.documentElement.className+=" js_active ",document.documentElement.className+="ontouchstart"in document.documentElement?" avia_mobile ":" avia_desktop ",function(){var a=["-webkit-","-o-","-moz-","-ms-",""];for(var e in a)if(a[e]+"transform"in document.documentElement.style){document.documentElement.className+=" avia_transform ";break}}(),function(a){"use strict";a.AviaBuilder=function(){this.body_container=a("body").eq(0),this.canvas=a("#aviaLayoutBuilder"),this.canvasParent=this.canvas.parents(".postbox").eq(0),this.activeStatus=this.canvasParent.find("#aviaLayoutBuilder_active"),this.shortcodes=a.AviaBuilder.shortcodes||{},this.safemode=avia_globals.builderMode||!1,this.tiny_active=void 0!==window.tinyMCE,this.tiny_version=!!this.tiny_active&&window.tinyMCE.majorVersion,this.classic_editor=a("#postdivrich"),this.classic_editor_wrap=a("#postdivrich_wrap"),this.switch_button=this.classic_editor_wrap.find(".avia-builder-button"),this.classic_textarea=a("#content.wp-editor-area"),this.secureContent=a("#_aviaLayoutBuilderCleanData"),this.datastorage='textarea[data-name="text-shortcode"]',this.shortcode_wrap=a(".shortcode_button_wrap"),this.sort_button_wrap=a("#avia-sort-list-dropdown"),this.element_templates=new a.AviaElementTemplates(this),this.targetInsert=!1,this.only_one_insert=!1,this.update_timout=!1,this.disable_autoswitch_editor_style=!1,this.builder_drag_drop_container="body",this.save_modal_handler=this.send_to_datastorage,this.close_modal_handler=null,this.modal_popup_state_default={post_id:0,shortcode:"",tab_text:"",toggle_text:"",group_shortcode:"",group_tab_text:"",group_toggle_text:""},this.modal_popup_state=a.extend({},this.modal_popup_state_default),this.set_up(),this.body_container.trigger("AviaBuilder_after_set_up",this);const e={bubbles:!0,cancelable:!0,detail:{builder:this}};this.body_container[0].dispatchEvent(new CustomEvent("AviaBuilderAfterSetUp",e))},a.AviaBuilder.prototype={set_up:function(){this.place_top(),this.convertTextToInterface(),this.add_behavior(),this.init_modal_popup_state(),this.body_container.hasClass("avia-force-alb")&&"active"!=this.activeStatus.val()&&this.switch_button.trigger("click")},clear_av_uid:function(a){return a.replace(/av_uid='[^']*'|av_uid="[^"]*"/gi,"av_uid=''")},place_top:function(){var e=a("#normal-sortables"),t=e.find(".postbox");this.canvasParent.length&&0!==t.index(this.canvasParent)&&(this.canvasParent.prependTo(e),e.is(".ui-sortable")||window.postboxes.init(),void 0===window.postboxes||"function"!=typeof window.postboxes.save_order?setTimeout((function(){window.postboxes.save_order(pagenow)}),500):window.postboxes.save_order(pagenow))},add_behavior:function(){var e=this,t=a("body");this.switch_button.on("click",(function(a){a.preventDefault(),e.switch_layout_mode(a)})),this.sort_button_wrap.on("click",".avia-sort-list-element",(function(t){t.preventDefault();var o=a(this),i=e.sort_button_wrap.data("init_sort"),n=o.find("a"),l=n.data("sorting"),r=n.attr("title"),s=e.sort_button_wrap.find(".avia-sort-list-label"),d=a("body").is(".avia-block-editor-expand.block-editor-page"),_=a(".avia-expanded").length,c=d&&_?a(".avia-fixed-controls .shortcode_button_wrap"):e.shortcode_wrap;if(c.find(".shortcode_insert_button").removeClass("ui-draggable"),"string"==typeof r&&e.sort_button_wrap.attr("title",r),n.hasClass("sort_active")&&l==i)return!1;if(e.sort_button_wrap.find(".avia-sort-list-element a").removeClass("sort_active"),n.addClass("sort_active"),s.html(n.html()),e.sort_shortcode_buttons(l),l==i)return!1;e.activate_element_dragging(c,""),c.trigger("avia_shortcode_buttons_sorted");var v={action:"avia_alb_shortcode_buttons_order",sorting:l,avia_request:!0,_ajax_nonce:a("#avia-loader-nonce").val()};a.ajax({type:"POST",url:ajaxurl,dataType:"json",cache:!1,data:v,post_type:a(".avia-builder-main-wrap").data("post_type"),success:function(t,o,i){1==t.success&&(a("#avia-loader-nonce").val(t._ajax_nonce),e.sort_button_wrap.data("init_sort",l))},error:function(a){},complete:function(a){}})})),this.InitialTriggerSortShortcodeButtons(),this.element_templates.init(),this.shortcode_wrap.on("click",".shortcode_insert_button",(function(){var t=a(this),o=a(this).parents(".shortcode_button_wrap"),i=this.hash.replace("#","");this.className.indexOf("avia-active-insert");return o.hasClass("avia-edit-elements-clicked")||t.hasClass("avia-custom-element-item")||t.is(".av-shortcode-disabled")||e.shortcodes.fetchShortcodeEditorElement(i,"instant_insert",e),!1})),this.canvas.on("click","a.avia-delete:not(.av-no-drag-drop a, .av-special-delete)",(function(){return e.shortcodes.deleteItem(this,e),!1})),this.canvas.on("click","a.avia-change-col-size:not(.avia-change-cell-size, .av-no-drag-drop a)",(function(){return e.shortcodes.changeSize(this,e),!1})),this.canvas.on("click","a.avia-add-cell:not( .av-no-drag-drop a )",(function(){return e.shortcodes.addCell(this,e),!1})),this.canvas.on("click","a.avia-set-cell-size:not( .av-no-drag-drop a )",(function(){return e.shortcodes.setCellSize(this,e),!1})),t.on("click",".avia-toggle-visibility, .avia-layout-element-hidden",(function(t){t.preventDefault();var o=a(this).parents(".av_drag").eq(0),i=o.find(">.avia_inner_shortcode>"+e.datastorage).eq(0),n=o.is(".av-layout-element-closed")?"0":"1",l=i.val();o.toggleClass("av-layout-element-closed");var r=e.set_shortcode_single_value(l,"av_element_hidden_in_editor",n,i);i.val(r),e.updateTextarea()})),t.on("click",".avia-edit-element",(function(t){var o=a(this),i=o.parents(".avia_sortable_element").eq(0);i.length||(i=o.parents(".avia_layout_column").eq(0)).length||(i=o.parents(".avia_layout_section").eq(0));var n=i.data(),l=i.hasClass("avia-no-visual-updates"),r=i,s=void 0!==i.data("update_element_template")&&"yes"==i.data("update_element_template")?i:[];0==s.length&&(s=i.find('[data-update_element_template="yes"]').first()),n.modal_class="avia-base-shortcode",o.closest(".avia_layout_builder_custom_elements").length>0?n.modal_class+=" avia-modal-edit-custom-element":n.modal_class+=" avia-modal-edit-alb-element",n.obj_clicked=o,n.template_changed=i.hasClass("element_template_changed"),n.scope=e,n.on_load=i.data("modal_on_load"),n.before_save=i.data("before_save"),n.on_save=e.save_modal_handler,n.before_close=e.close_modal_handler,n.save_param=i,n.ajax_param={extract:!0,shortcode:i.find(">.avia_inner_shortcode>"+e.datastorage).eq(0).val(),outer_sc_params:[],sc_params:[],allowed:n.allowedShortcodes,_ajax_nonce:a("#avia-loader-nonce").val()};var d="";if(isNaN(n.preview_scale)||(d="<span class='avia-modal-preview-scale'>"+window.avia_preview.scale+" "+n.preview_scale+"%</span>"),n.preview){n.modal_class+=" modal-preview-active modal-preview-"+n.preview,n.on_load=""!=n.on_load?n.on_load+", modal_preview_script":"modal_preview_script",n.attach_content="<div class='avia-modal-preview'><div class='avia-modal-preview-header'><h3 class='avia-modal-title'>"+window.avia_preview.title+"</h3><div class='avia_loading'></div></div><div class='avia-modal-preview-content' data-preview-scale='"+n.preview_scale+"'></div><div class='avia-modal-preview-footer'><span>"+window.avia_preview.background+"</span><a href='#' style='background:#fff;'></a><a href='#' style='background:#f1f1f1;'></a><a href='#' style='background:#222;'></a>"+d+"</div></div>"}new a.AviaModal(n);return i.hasClass("element_template_changed")&&s.length>0&&(e.body_container.one("AviaBuilder_interface_loaded_response",(function(e,t){if("string"==typeof t){var o=a(t),i=void 0!==o.data("update_element_template")&&"yes"==o.data("update_element_template")?o:[];0==i.length&&(i=o.find('[data-update_element_template="yes"]').first()),i.length>0&&(s.replaceWith(i),l&&(void 0!==i.data("initial_el_bg")&&r.find(".avia-element-bg-color").first().attr("style",i.data("initial_el_bg")),void 0!==i.data("initial_layout_element_bg")&&r.find(".avia-layout-element-bg").first().attr("style",i.data("initial_layout_element_bg"))))}})),e.convertTextToInterface(n.ajax_param.shortcode,!0)),i.removeClass("element_template_changed"),!1})),t.on("click",".avia-modal-group-element-inner",(function(){if(a(this).closest(".avia-modal-group-wrapper").hasClass("avia-modal-locked"))return!1;var t=a(this),o=t.closest(".avia-modal"),i=t.parents(".avia-modal-group-element").eq(0),n=i.data(),l=o.data("avia_modal_object"),r=void 0!==i.data("update_element_template")&&"yes"==i.data("update_element_template")?i:[];if(0==r.length&&(r=i.find('[data-update_element_template="yes"]').first()),void 0!==i.data("modal_open")&&"no"==i.data("modal_open"))return void 0!==i.data("trigger_button")&&""!=i.data("trigger_button").trim()&&i.closest(".avia-modal-group-wrapper ").find("."+i.data("trigger_button").trim()).trigger("click"),!1;n.modal_class="avia-modal-group-shortcode",o.hasClass("avia-modal-edit-custom-element")?(n.modal_class+=" avia-modal-edit-custom-element",n.modal_class+=o.hasClass("avia-edit-item-template")?" avia-edit-item-template":" avia-edit-base-template"):n.modal_class+=" avia-modal-edit-alb-element",n.obj_clicked=t,n.template_changed=i.hasClass("element_template_changed"),n.scope=e,n.on_load=i.data("modal_on_load"),n.before_save=i.data("before_save"),n.on_save=e.save_modal_handler,n.before_close=e.close_modal_handler,n.save_param=i,n.shortcodehandler=i.data("shortcodehandler");var s=l.get_final_values();n.ajax_param={subelement:!0,extract:!0,shortcode:i.find(e.datastorage).eq(0).val(),outer_sc_params:s,sc_params:[],_ajax_nonce:a("#avia-loader-nonce").val()};o=new a.AviaModal(n);return i.hasClass("element_template_changed")&&r.length>0&&(e.body_container.one("AviaBuilder_modal_group_loaded_response",(function(e,t){if("string"==typeof t){var o=a(t),i=void 0!==o.data("update_element_template")&&"yes"==o.data("update_element_template")?o:[];0==i.length&&(i=o.find('[data-update_element_template="yes"]').first()),i.length>0&&r.replaceWith(i)}})),e.convertToModalGroupInterface(n.ajax_param.shortcode,n.shortcodehandler,e)),!1})),t.on("click",".avia-attach-modal-element-delete",(function(a){e.shortcodes.deleteModalSubItem(this,a)})),t.on("click",".avia-attach-modal-element-add",(function(a){e.shortcodes.appendModalSubItem(this,a)})),t.on("click",".avia-attach-modal-element-clone",(function(a){e.shortcodes.appendModalSubItem(this,a,"clone")})),this.canvas.on("click","a.avia-clone:not( .av-no-drag-drop a , .av-special-clone)",(function(){return e.cloneElement(this,e),!1})),this.canvas.on("change","select.avia-recalc-shortcode",(function(){var t=a(this).parents(".avia_sortable_element").eq(0);return e.recalc_shortcode(t),!1})),this.canvas.on("avia-history-update",(function(){e.activate_element_dragging(this.canvasParent,""),e.activate_element_dropping(this.canvasParent,"")})),t.on("av-element-to-editor av-element-deleted-from-editor av-element-dropped-in-editor",(function(a){t.hasClass("post-type-alb_elements")&&(e.canvas.find(".avia_sortable_element, .avia_layout_column, .av_section, .avia_layout_row").length>=1?e.canvasParent.addClass("element-added"):e.canvasParent.removeClass("element-added"))}))},init_modal_popup_state:function(){let e=[];if(e=this.body_container.hasClass("block-editor-page")?a("#metaboxes form.metabox-base-form"):a('form[id="post"]'),0!=e.length){var t=e.find("#post_ID").val(),o=this.get_modal_popup_state();!1!==o&&(void 0===o||void 0===o.post_id||o.post_id!=t?(this.modal_popup_state=a.extend({},this.modal_popup_state_default),this.modal_popup_state.post_id=t):this.modal_popup_state=o,this.save_modal_popup_state())}else this.modal_popup_state=!1},clear_modal_popup_state:function(e,t){if(!1!==this.modal_popup_state){var o=this.modal_popup_state;return this.modal_popup_state=a.extend({},this.modal_popup_state_default),this.modal_popup_state.post_id=o.post_id,t?(this.modal_popup_state.shortcode=o.shortcode,this.modal_popup_state.tab_text=o.tab_text,this.modal_popup_state.toggle_text=o.toggle_text,this.modal_popup_state.group_shortcode=e):this.modal_popup_state.shortcode=e,this.save_modal_popup_state(),this.modal_popup_state}},set_modal_popup_state:function(e,t,o){if(!1!==this.modal_popup_state){this.modal_popup_state[e]=t,this.save_modal_popup_state();var i=o.options.save_param.hasClass("avia-modal-group-element")?"avia-modal-group-last-open":"avia-modal-element-last-open";a("body").find("."+i).removeClass(i),o.options.save_param.addClass(i)}},get_modal_popup_state:function(){var a=null;if("undefined"==typeof sessionStorage)return a;try{a=null==(a=sessionStorage.getItem("aviaModalPopupState"))?{}:JSON.parse(a)}catch(e){return this.modal_popup_state=!1,this.modal_popup_state}return a},save_modal_popup_state:function(){if("undefined"!=typeof sessionStorage&&!1!==this.modal_popup_state){var a=JSON.stringify(this.modal_popup_state);try{sessionStorage.setItem("aviaModalPopupState",a)}catch(e){avia_log("Info - Session Storage: Browser memory limit reached, blocked or not supported. We are not able to save the state of the last open options tabs in modal popup windows of ALB elements."),avia_log(e)}}},sort_shortcode_buttons:function(e){var t=a("body").is(".avia-block-editor-expand.block-editor-page"),o=a(".avia-expanded").length;(t&&o?a(".avia-fixed-controls .shortcode_button_wrap"):this.shortcode_wrap).find(".avia-tab").each((function(t){var o=a(this),i=o.find("a");o.find("a").remove(),i.sort((function(t,o){var i="",n="",l=0,r=a(t),s=a(o);switch(e){case"name_asc":if(void 0===(i=r.data("sort_name"))){l=1;break}if(void 0===(n=s.data("sort_name"))){l=1;break}l=i<n?-1:i==n?0:1;break;case"name_desc":if(void 0===(i=r.data("sort_name"))){l=1;break}if(void 0===(n=s.data("sort_name"))){l=1;break}l=i<n?1:i==n?0:-1;break;case"usage":if(void 0===(i=r.data("sort_usage"))){l=1;break}if(void 0===(n=s.data("sort_usage"))){l=1;break}var d=r.data("sort_name"),_=s.data("sort_name");l=i<n?1:i==n?void 0===d?1:void 0===_||d<_?-1:d==_?0:1:-1;break;default:if(void 0===(i=r.data("sort_order"))){l=1;break}if(void 0===(n=s.data("sort_order"))){l=1;break}l=i<n?-1:i==n?0:1}return l})),o.html(i)}))},InitialTriggerSortShortcodeButtons:function(){var a=this.sort_button_wrap.data("init_sort");"string"!=typeof a&&(a="order"),this.sort_button_wrap.find('a[data-sorting="'+a+'"]').trigger("click")},replace_js_templates:function(e){var t=this.body_container;a.each(e,(function(e,o){var i=a(e).first();i.length>0?i.replaceWith(o):t.append(o)}))},cmpVersion:function(a,e){var t,o,i,n=/(\.0)+[^\.]*$/;for(a=(a+"").replace(n,"").split("."),e=(e+"").replace(n,"").split("."),i=Math.min(a.length,e.length),t=0;t<i;t++)if(0!==(o=parseInt(a[t],10)-parseInt(e[t],10)))return o;return a.length-e.length},activate_element_dragging:function(e,t){var o=this.cmpVersion(a.ui.draggable.version,"1.10.9")<=0,i=a(window);-1===navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")||(o=!1),o&&avia_log("drag and drop positioning fix active");var n=this,l=e||this.canvasParent,r={appendTo:this.builder_drag_drop_container,handle:">.menu-item-handle:not( .av-no-drag-drop .menu-item-handle )",helper:"clone",scroll:!0,cancel:"#aviaLayoutBuilder .avia_sorthandle a, input, textarea, button, select, option",zIndex:2e4,cursorAt:{left:20},start:function(e,t){var o=a(e.target);if(o.closest(".shortcode_button_wrap").hasClass("avia-edit-elements-clicked")||o.hasClass("avia-custom-element-item"))return!1;o.css({opacity:.4}),a(".avia-hover-active").removeClass("avia-hover-active"),n.canvas.addClass("avia-select-target-"+o.data("dragdrop-level"))},drag:function(a,e){o&&(e.position.top-=parseInt(i.scrollTop()))},stop:function(e,t){a(e.target).css({opacity:1}),a(".avia-hover-active").removeClass("avia-hover-active"),n.canvas.removeClass("avia-select-target-1 avia-select-target-2 avia-select-target-3 avia-select-target-4")}};void 0===t&&(t=":not(.ui-draggable)"),l.find(".av_drag"+t).draggable(r),r.cursorAt={left:33,top:33},r.handle=!1,l.find(".shortcode_insert_button").not(".ui-draggable, .av-shortcode-disabled").draggable(r)},activate_element_dropping:function(e,t){var o=this,i=e||this.canvasParent,n={tolerance:"pointer",greedy:!0,over:function(e,t){var i=a(this);o.droping_allowed(t.helper,i)&&i.addClass("avia-hover-active")},out:function(e,t){a(this).removeClass("avia-hover-active")},drop:function(e,t){var i=a(this);if(!i.is(".avia-hover-active"))return!1;for(var n,l,r=i.find(">.av_drag"),s={},d="after",_=!1,c=[],v=0;v<r.length;v++){var u=r.eq(v);if(!((s=u.offset()).top<t.offset.top))break;_=u,n=s,c["top_"+s.top]||(l=0,c["top_"+s.top]=[]),l=l>u.outerHeight()+s.top?l:u.outerHeight()+s.top,c["top_"+s.top].push({left:s.left,top:s.top,index:v,height:u.outerHeight(),maxheight:u.outerHeight()+s.top})}if(n&&c["top_"+n.top].length>1&&l-40>t.offset.top){var h=!1;for(v=0;v<c["top_"+n.top].length&&c["top_"+n.top][v].left<t.offset.left;v++)h=c["top_"+n.top][v].index;!1===h&&(h=c["top_"+n.top][0].index,d="before"),_=r.eq(h)}if(!1===_&&(_=i,d="prepend"),_[0]==t.draggable[0])return;if(t.draggable[0].hash){var p=t.draggable.get(0).hash.replace("#",""),f=a(a("#avia-tmpl-"+p).html());t.draggable=f}var g=t.draggable.parents(".av_drag").last();_[d](t.draggable),g.length&&o.updateInnerTextarea(!1,g),0!==("after"==d?_.parents(".av_drop"):_).data("dragdrop-level")&&(o.updateTextarea(),o.updateInnerTextarea(t.draggable)),o.updateTextarea(),o.targetInsertInactive(),void 0!==f&&(o.body_container.trigger("av-builder-new-element-added",t.draggable),o.canvas.removeClass("ui-droppable").droppable("destroy"),o.activate_element_dragging(),o.activate_element_dropping()),o.do_history_snapshot(),a("body").trigger("av-element-dropped-in-editor");let m=document.getElementsByTagName("body");if(m.length>0){const a=new CustomEvent("av-alb-element-dropped-in-editor",{bubbles:!0,cancelable:!0});m[0].dispatchEvent(a)}}};void 0===t&&(t=":not(.ui-droppable)"),"destroy"==t&&(i.find(".av_drop").droppable("destroy"),t=""),i.find(".av_drop"+t).droppable(n)},droping_allowed:function(a,e){return a.data("dragdrop-level")>e.data("dragdrop-level")},switch_layout_mode:function(e){var t=this,o=!!this.tiny_active&&window.tinyMCE.get("content");return t.switch_button.is(".av-builder-button-disabled")||("active"!=this.activeStatus.val()?(!1===this.disable_autoswitch_editor_style&&a("#content-html").trigger("click"),t.body_container.addClass("avia-advanced-editor-enabled"),t.body_container.removeClass("wp-default-editor-enabled"),t.classic_editor_wrap.addClass("avia-hidden-editor"),t.switch_button.addClass("avia-builder-active").text(t.switch_button.data("active-button")),t.activeStatus.val("active"),t.canvasParent.removeClass("avia-hidden"),setTimeout((function(){!1===this.disable_autoswitch_editor_style&&a("#content-tmce").trigger("click"),t.convertTextToInterface(),t.body_container.trigger("AviaBuilder_after_switch_layout_mode",t.switch_button,t.activeStatus.val())}),100)):(this.body_container.removeClass("avia-advanced-editor-enabled"),this.body_container.addClass("wp-default-editor-enabled"),this.classic_editor_wrap.removeClass("avia-hidden-editor"),this.switch_button.removeClass("avia-builder-active").text(this.switch_button.data("inactive-button")),this.activeStatus.val(""),this.canvasParent.addClass("avia-hidden"),this.canvas.addClass("preloading").find(">*:not(.avia-controll-bar, .avia-insert-area)").remove(),a(window).trigger("scroll"),this.safemode&&"safe"==this.safemode&&-1!==this.secureContent.val().indexOf("[")&&(avia_log("Switching to Classic Editor. Template Builder is in safe mode and will empty the textarea so user cant edit shortcode directly"),o&&o.setContent("",{format:"html"}),this.classic_textarea.val("")),this.body_container.trigger("AviaBuilder_after_switch_layout_mode",this.switch_button,this.activeStatus.val()))),!1},sendToAdvancedEditor:function(e,t){var o=a(e);void 0!==t&&"prepend"==t?this.canvas.prepend(o):this.canvas.append(o),this.activate_element_dragging(),this.activate_element_dropping(),this.body_container.trigger("av-element-to-editor")},updateInnerTextarea:function(e,t){if(void 0===t&&(t=a(e).parents(".avia_layout_section").eq(0)),t.length||(t=a(e).parents(".avia_layout_column").eq(0)),t.length){if(t.is(".avia_layout_section")){for(var o=t.find(".avia_layout_column_no_cell"),i=0;i<o.length;i++)this.updateInnerTextarea(!1,a(o[i]));for(o=t.find(".avia_layout_cell"),i=0;i<o.length;i++)this.updateInnerTextarea(!1,a(o[i]));for(o=t.find(".avia_layout_tab"),i=0;i<o.length;i++)this.updateInnerTextarea(!1,a(o[i]));var n=t.find(">.avia_inner_shortcode >"+this.datastorage),l=t.find(">.avia_inner_shortcode > div "+this.datastorage+":not(.avia_layout_column .avia_sortable_element "+this.datastorage+", .avia_layout_cell .avia_layout_column "+this.datastorage+" , .avia_layout_tab .avia_layout_column "+this.datastorage+" )"),r="",s=t.data("shortcodehandler"),d=n.val().match(new RegExp("\\["+s+"[^]*?\\]"));for(i=0;i<l.length;i++)r+=a(l[i]).val();r=d[0]+"\n\n"+r+"[/"+s+"]",n.val(r)}if(t.is(".avia_layout_cell")){n=t.find(">.avia_inner_shortcode >"+this.datastorage),l=t.find(">.avia_inner_shortcode > div "+this.datastorage+":not(.avia_layout_column_no_cell .avia_sortable_element "+this.datastorage+")"),r="";var _=t.data("width");for(d=n.val().match(new RegExp("\\["+_+"[^]*?\\]")),i=0;i<l.length;i++)r+=a(l[i]).val();r=d[0]+"\n\n"+r+"[/"+_+"]",n.val(r)}if(t.is(".avia_layout_tab")){n=t.find(">.avia_inner_shortcode >"+this.datastorage),l=t.find(">.avia_inner_shortcode > div "+this.datastorage+":not(.avia_layout_column_no_cell .avia_sortable_element "+this.datastorage+")"),r="";var c=t.hasClass("avia-slideshow-section-tab")?"av_slide_sub_section":"av_tab_sub_section";for(d=n.val().match(new RegExp("\\["+c+"[^]*?\\]")),i=0;i<l.length;i++)r+=a(l[i]).val();r=d[0]+"\n\n"+r+"[/"+c+"]",n.val(r)}if(t.is(".avia_layout_column:not(.avia_layout_cell, .avia_layout_tab)")){for(n=t.find(">.avia_inner_shortcode >"+this.datastorage),l=t.find(".avia_sortable_element "+this.datastorage),r="",_=t.data("width"),t.is(".avia-first-col"),d=n.val().match(new RegExp("\\["+_+"[^]*?\\]")),i=0;i<l.length;i++)r+=a(l[i]).val();r=d[0]+"\n\n"+r+"[/"+_+"]",n.val(r)}}},updateTextarea:function(e,t,o,i){if("active"==this.activeStatus.val()){var n=".avia_layout_builder";if("string"==typeof t&&""!=t.trim()&&(n=t),!e){var l=this;a(n).find(".avia_layout_section").each((function(){var e=a(this).find(">.avia_inner_shortcode > div > .avia_inner_shortcode"),i=a(this).find(" .avia_layout_cell .avia_layout_column_no_cell > .avia_inner_shortcode");a(this).find(".avia_layout_tab").each((function(){var e=a(this).find(".avia_layout_column_no_cell > .avia_inner_shortcode");l.updateTextarea(e,t,o,!0)})),i.length&&l.updateTextarea(i,t,o,!0),e.length&&l.updateTextarea(e,t,o,!0)})),e=a(n+" > div > .avia_inner_shortcode")}for(var r,s,d,_,c=e.find(">"+this.datastorage),v="",u=0,h={av_one_full:1,av_four_fifth:.8,av_three_fourth:.75,av_two_third:.66,av_three_fifth:.6,av_one_half:.5,av_two_fifth:.4,av_one_third:.33,av_one_fourth:.25,av_one_fifth:.2},p=0;p<c.length;p++)d=(r=a(c[p])).parents(".avia_layout_column_no_cell").eq(0),s=r.val(),d.length?(u+=h[_=d.data("width")])>1||0==p?(d.is(".avia-first-col")||(d.addClass("avia-first-col"),s=s.replace(new RegExp("^\\["+_),"["+_+" first"),r.val(s)),u=h[_]):d.is(".avia-first-col")&&(d.removeClass("avia-first-col"),s=s.replace(" first",""),r.val(s)):u=1,v+=s;if("string"!=typeof o||""==o.trim()){var f=this.tiny_active?window.tinyMCE.get("content"):void 0;void 0!==f&&(clearTimeout(this.update_timout),this.update_timout=setTimeout((function(){f.setContent(window.switchEditors.wpautop(v),{format:"html"})}),500)),this.classic_textarea.val(v).trigger("av_update"),this.secureContent.val(v).trigger("av_secureContent_update",i)}else a(o).val(v)}},do_history_snapshot:function(a){var e=this;a||(a=150),setTimeout((function(){e.canvas.trigger("avia-storage-update")}),a)},convertToModalGroupInterface:function(e,t,o){void 0!==e&&a.ajax({type:"POST",url:ajaxurl,dataType:"json",cache:!1,data:{action:"avia_ajax_modal_group_to_interface",text:e,shortcode:t,avia_request:!0,post_type:a(".avia-builder-main-wrap").data("post_type"),_ajax_nonce:a("#avia-loader-nonce").val()},success:function(a){1==a.success&&o.body_container.trigger("AviaBuilder_modal_group_loaded_response",[a.html])}})},convertTextToInterface:function(e,t){if(!(t=!0===t)){if("active"!=this.activeStatus.val())return this.body_container.addClass("wp-default-editor-enabled"),void this.body_container.removeClass("avia-advanced-editor-enabled");this.body_container.addClass("avia-advanced-editor-enabled"),this.body_container.removeClass("wp-default-editor-enabled")}var o=this;void 0===e&&-1===(e=this.secureContent.val()).indexOf("[")&&(e=this.classic_textarea.val(),this.tiny_active&&(e=window.switchEditors._wp_Nop(e)),e=e.replace(/<\s*?span\b[^>]*mce_SELRES_start[^>]*>(.*?)<\/span\b[^>]*>/gi,""),this.secureContent.val(e)),a.ajax({type:"POST",url:ajaxurl,data:{action:"avia_ajax_text_to_interface",text:e,avia_request:!0,post_id:a(".avia-builder-main-wrap").data("post_id"),post_type:a(".avia-builder-main-wrap").data("post_type"),_ajax_nonce:a("#avia-loader-nonce").val()},success:function(e){t?o.body_container.trigger("AviaBuilder_interface_loaded_response",[e]):(a("#content-tmce").trigger("click"),o.sendToAdvancedEditor(e),o.canvas.removeClass("preloading"),o.do_history_snapshot(),o.body_container.trigger("AviaBuilder_interface_loaded"))}})},targetInsertActive:function(e,t){t||(t="avia-hover-target avia-select-target-"+a(e).data("dragdrop-level")),a(".avia-hover").removeClass("avia-hover"),this.canvas.addClass(t),this.targetInsert=e},targetInsertInactive:function(){a(".shortcode_button_wrap").find(".avia-active-insert").removeClass("avia-active-insert"),this.canvas.removeClass("avia-hover-target avia-select-target-1 avia-select-target-2 avia-select-target-3 avia-select-target-4"),this.targetInsert="",this.only_one_insert=!1},doTargetInsert:function(e,t,o){var i=a(e),n="object"==typeof t.targetInsert?t.targetInsert:a(t.targetInsert);if(t.droping_allowed(n,i)){void 0===o&&(o="append"),"append"==o&&i.append(t.targetInsert),"prepend"==o&&i.prepend(t.targetInsert),e.length||t.updateInnerTextarea(e);var l=i.parents(".avia_layout_section").eq(0);l.length&&(t.updateTextarea(),t.updateInnerTextarea(!1,l)),0!=this.only_one_insert&&(t.updateInnerTextarea(!1,this.only_one_insert),t.targetInsertInactive()),t.activate_element_dragging(),t.activate_element_dropping(),t.updateTextarea(),t.do_history_snapshot()}},changeTargetingShortcode:function(e){var t=37==e?-1:1,o=a(".shortcode_button_wrap").last(),i=o.find(".avia-target-insert"),n=i.filter(".avia-active-insert"),l=i.index(n),r=i.eq(l+t);if(r.length||(r=1==t?i.first():i.last()),r.trigger("click"),!r.is(":visible")){var s=o.find(".avia-tab"),d=r.parent(),_=s.index(d);o.find(".avia-tab-title-container a").eq(_).trigger("click")}return!1},cloneElement:function(e,t){var o=a(e),i=o.parents(".avia_sortable_element").eq(0),n=!1;if(i.length||(i=o.parents(".avia_layout_column").eq(0)),i.length||(i=o.parents(".avia_layout_section").eq(0)),i.is(".avia_layout_cell")){var l=i.parents(".avia_layout_row").eq(0).find(".avia_layout_cell").length;if(void 0===a.AviaBuilder.layoutRow.newCellOrder[l])return!1;n=!0}i.find("textarea").each((function(){this.innerHTML=this.value}));var r=i.clone();r.find("textarea").each((function(){var e=a(this),t=e.val();t=a.avia_builder.clear_av_uid(t),e.val(t),this.innerHTML=t})),r.removeClass("ui-draggable ui-droppable").find(".ui-draggable, .ui-droppable").removeClass("ui-draggable ui-droppable"),r.insertAfter(i);var s=i.parents(".avia_layout_section, .avia_layout_column");n&&a.AviaBuilder.shortcodes.recalcCell(e,t),(i.is(".avia_layout_column")||i.is(".avia_layout_section")||s.length)&&(s.length&&t.updateTextarea(),t.updateInnerTextarea(i)),t.body_container.trigger("av-builder-new-element-added",r),t.activate_element_dragging(),t.activate_element_dropping(),t.updateTextarea(),t.do_history_snapshot()},recalc_shortcode:function(e){for(var t=e.find("select.avia-recalc-shortcode"),o=!1,i=[],n=0;n<t.length;n++)i[(o=a(t[n])).data("attr")]=o.val();this.send_to_datastorage(i,e)},send_to_datastorage:function(a,e,t,o){var i=e.is(".avia-modal-group-element")?this.datastorage:">.avia_inner_shortcode>"+this.datastorage,n=e.find(i).eq(0),l=e.parents(".avia_layout_column").eq(0),r=e.parents(".avia_layout_section").eq(0),s=e.data("shortcodehandler"),d="",_={};if(avia_log(a,!1),"string"==typeof a)d=a;else{var c=this.update_builder_html(e,a);d=c.output,_=c.tags}if("return"==t)return d;if(e.is(".avia_layout_section")||e.is(".avia_layout_column")?n.val(n.val().replace(new RegExp("^\\["+s+".*?\\]"),_.open)):n.val(d),r.length?this.updateInnerTextarea(!1,r):l.length&&this.updateInnerTextarea(!1,l),"string"==typeof o&&""!=o.trim())return o=o.split(","),this.updateTextarea(null,o[0],o[1]),d;this.updateTextarea(),this.do_history_snapshot(),e.trigger("update"),n.trigger("av-update-preview-instant");const v=new CustomEvent("av-alb-canvas-updated",{bubbles:!0,cancelable:!0});return e[0].dispatchEvent(v),d},set_shortcode_single_value:function(a,e,t){var o=new RegExp("\\[.*?("+e+"=('|\").*?['|\"]).*?\\]"),i=a.match(o);if(i&&void 0!==i[1]){var n=new RegExp(i[1]);a=a.replace(n,e+"="+i[2]+t+i[2])}else{var l=" "+e+"='"+t+"' ",r=a.indexOf("]"),s=a.indexOf("/]");s+1==r&&(r=s),a=a.substr(0,r)+l+a.substr(r)}return a},update_builder_html:function(e,t,o){var i,n,l,r;for(i in t)t.hasOwnProperty(i)&&(l=i.replace(/aviaTB/g,""))!=i&&(r=void 0!==t[l]?t[l]+",":"",t[l]=r?r+t[i]:t[i],delete t[i]);for(i in t)if(t.hasOwnProperty(i)&&"content"!=i)if("string"==typeof t[i])t[i]=t[i].replace(/'(.+?)'/g,"‘$1’").replace(/'/g,"’"),"av_uid"==i&&""==t[i].trim()&&(t[i]="av-"+(new Date).getTime().toString(36));else if("object"==typeof t[i])for(n in t[i])t[i][n]=t[i][n].replace(/'(.+?)'/g,"‘$1’").replace(/'/g,"’");var s=e.data("shortcodehandler"),d=e.find("[data-update_with]"),_=e.find("[data-update_class_with]"),c=e.data("closing_tag"),v="",u="",h="",p="",f="",g="",m=e.hasClass("avia-force-empty-update-value");if(!0!==(o=void 0!==o&&o)&&"string"==typeof c&&"yes"==c&&(o=!0),e.is(".avia-no-visual-updates")){var b=e.find(".avia_data_locked_container").first();if(void 0!==t.id&&null!=t.id){var y=""==t.id?"":": "+t.id;e.find(".avia-element-title-id").eq(0).text(y)}if(e.find(".avia-element-bg-color").eq(0).length){var w="",x=void 0===b.data("locked_background")?t.background:b.data("locked_background");if("bg_color"==x)w=void 0!==b.data("locked_custom_bg")?b.data("locked_custom_bg"):void 0!==b.data("locked_background_color")?b.data("locked_background_color"):t.custom_bg||t.background_color||"";else if("bg_gradient"==x){var C=void 0===b.data("locked_background_gradient_color1")?t.background_gradient_color1:b.data("locked_background_gradient_color1"),k=void 0===b.data("locked_background_gradient_color2")?t.background_gradient_color2:b.data("locked_background_gradient_color2");""!==C&&""!==k&&(w="linear-gradient("+C+", "+k+")")}e.find(".avia-element-bg-color").eq(0).css("background",w)}var T=void 0!==t.tab_title&&null!=t.tab_title?t.tab_title:null;if(void 0!==b.data("locked_tab_title")&&(T=b.data("locked_tab_title")),null!=T){var S=""==t.tab_title?"":": "+T,A=e.data("av-tab-section-content");e.parents(".avia_tab_section").eq(0).find('.avia_tab_section_titles [data-av-tab-section-title="'+A+'"] .av-tab-custom-title').html(S)}var I=void 0!==t.src&&null!=t.src?t.src:null;if(void 0!==b.data("locked_src")&&(I=""!=b.data("locked_src")?b.data("locked_src"):null),null!=I){var B=t.position||t.background_position||"",q=t.repeat||t.background_repeat||"",E="",j={};void 0!==b.data("locked_position")&&(B=b.data("locked_position")),void 0!==b.data("locked_background_position")&&(B=b.data("locked_background_position")),void 0!==b.data("locked_repeat")&&(q=b.data("locked_repeat")),void 0!==b.data("locked_background_repeat")&&(q=b.data("locked_background_repeat")),"stretch"==q&&(q="no-repeat",E="cover"),"contain"==q&&(q="no-repeat",E="contain"),j={background:"transparent url("+I+") "+q+" "+B},E&&(j.backgroundSize=E),e.find(".avia-layout-element-bg").last().css(j)}}else _.attr("class",""),d.each((function(){if(u=a(this),v=u.data("update_with"),h=u.data("update_template"),p=u.data("update_object"),m&&void 0===t[v]&&(t[v]=""),"string"==typeof t[v]||"number"==typeof t[v]||"object"==typeof t[v]){if(g=t[v],"content"===v&&(g=void 0!==window.switchEditors?window.switchEditors.wpautop(t[v]):avia_nl2br(t[v])),"object"==typeof g)if(p&&"all-elements"==p){var e="";a.each(g,(function(a,t){a>0&&(e+=", "),e+=t})),g=e}else g=g[0];if(h){var o=g,i=u.data("update_with_keys");void 0!==i&&void 0!==i[g]&&(o=i[g]),f=h.replace("{{"+v+"}}",o),h.includes("tmpl-hide-on-empty")&&""==o.trim()&&(f="")}else-1!==(f=g+"").indexOf("###avia64###:")&&(f=f.replace("###avia64###:",""),f=atob(f));u.html(f)}})),_.each((function(){u=a(this),v=u.data("update_class_with").split(",");for(var e=0;e<v.length;e++)if("string"==typeof t[v[e]])u.get(0).className+=" avia-"+v[e]+"-"+t[v[e]];else if("string"==typeof v[e]){var o=v[e].match(/___(.*)___/);null!=o&&o.length>1&&(u.get(0).className+=" "+o[1])}}));for(i in t)t.hasOwnProperty(i)&&-1!==i.indexOf("_fakeArg")&&delete t[i];var z={},R={};return R.output=this.createShortcode(t,s,z,o),R.tags=z,R.values=t,R},createShortcode:function(a,e,t,o){var i,n,l="",r="",s="",d=",",_="\n";if(t||(t={}),void 0!==a.content){if("object"==typeof a.content){for(-1!=a.content[0].indexOf("[")&&(d=_),n=0;n<a.content.length;n++)a.content[n]=a.content[n].trim();s=a.content.join(d)}else s=a.content;-1!=s.indexOf("[")&&(s=s.replace(/show_locked_options_fakeArg=''/gi,"")),s=_+s+_,delete a.content}for(i in a)if(a.hasOwnProperty(i))if(isNaN(i)){if(-1!=i.indexOf("_fakeArg"))continue;"object"==typeof a[i]&&null!==a[i]&&(a[i]=a[i].join(",")),r+=i+"='"+a[i]+"' "}else r+=a[i]+" ";return t.open="["+e+" "+r.trim()+"]",l=t.open,(s||void 0!==o&&1==o)&&(""==s.trim()&&(s=""),t.close="[/"+e+"]",l+=s+t.close),l+=_+_}},a((function(){a.avia_builder=new a.AviaBuilder}))}(jQuery),function(a){"use strict";a.AviaBuilder.shortcodes=a.AviaBuilder.shortcodes||{},a.AviaBuilder.shortcodes.fetchShortcodeEditorElement=function(e,t,o){var i=a("#avia-tmpl-"+e);i.length&&("instant_insert"==t?(o.sendToAdvancedEditor(i.html()),o.updateTextarea(),o.do_history_snapshot(0)):o.targetInsertActive(i.html()))},a.AviaBuilder.shortcodes.deleteItem=function(e,t,o){var i=a(e),n=i.parents(".avia_sortable_element").eq(0),l=!1,r=!1,s=200;if(void 0!==o&&(s=o),n.length?l=i.parents(".avia_inner_shortcode").eq(0):(n=i.parents(".avia_layout_column").eq(0),l=i.parents(".avia_layout_section").eq(0).find(">.avia_inner_shortcode"),n.length||(n=i.parents(".avia_layout_section").eq(0),l=!1)),n.length&&n.is(".avia_layout_cell")){if(!(l.find(".avia_layout_cell").length>1))return!1;r=!0,s=0}t.targetInsertInactive(),n.hide(s,(function(){if(r&&a.AviaBuilder.shortcodes.removeCell(e,t),n.remove(),l&&l.length){t.updateInnerTextarea(l);var o=l.parents(".avia_layout_section").eq(0),i=l.find(".avia_layout_cell").eq(0);(o.length||i.length)&&o.length&&"undefined"==o.find(".avia_inner_shortcode .avia_inner_shortcode "+t.datastorage).val()&&t.activate_element_dropping(o,"destroy")}t.updateTextarea(),""==t.secureContent.val()&&t.activate_element_dropping(t.canvasParent,"destroy"),t.do_history_snapshot(),a("body").trigger("av-element-deleted-from-editor")}))},a.AviaBuilder.shortcodes.deleteModalSubItem=function(e,t){t.stopImmediatePropagation();var o=a(e).parents(".avia-modal-group-element").eq(0),i=o.parents(".avia-modal-group").eq(0);i.trigger("av-item-delete",[o]),o.slideUp(200,(function(){o.remove(),i.find('textarea[data-name="text-shortcode"]').eq(0).trigger("av-update-preview-instant")}))},a.AviaBuilder.shortcodes.appendModalSubItem=function(e,t,o){t.preventDefault();var i=a(e).parents(".avia-modal-group-wrapper").eq(0),n=i.find(".avia-modal-group"),l=i.find(".avia-tmpl-modal-element"),r="";(r="clone"!=o?a(l.html()).appendTo(n).css({display:"none"}):i.find(".avia-modal-group-element").last().clone().appendTo(n).css({display:"none"})).slideDown(200),n.trigger("av-item-add",[r]),r.find('textarea[data-name="text-shortcode"]').trigger("av-update-preview-instant")},a.AviaBuilder.shortcodes.changeSize=function(e,t){for(var o=a(e),i=o.parents(".avia_layout_column").eq(0),n=i.parents(".avia_layout_section").eq(0),l=i.data("width"),r=[],s=o.is(".avia-bigger")?1:-1,d=i.find(".avia-col-size"),_=i.find("> .avia_inner_shortcode > "+t.datastorage),c=_.val(),v=[["av_one_full","1/1"],["av_four_fifth","4/5"],["av_three_fourth","3/4"],["av_two_third","2/3"],["av_three_fifth","3/5"],["av_one_half","1/2"],["av_two_fifth","2/5"],["av_one_third","1/3"],["av_one_fourth","1/4"],["av_one_fifth","1/5"]],u=0;u<v.length;u++)v[u][0]==l&&(r=v[u-s]);void 0!==r&&(c=(c=c.replace(new RegExp("^\\["+l,"g"),"["+r[0])).replace(new RegExp(l+"\\]","g"),r[0]+"]"),_.val(c),i.removeClass(l).addClass(r[0]),i.attr("data-shortcodehandler",r[0]).data("shortcodehandler",r[0]),i.attr("data-width",r[0]).data("width",r[0]),i.attr("data-modal_ajax_hook",r[0]).data("modal_ajax_hook",r[0]),i.attr("data-allowed-shortcodes",r[0]).data("allowed-shortcodes",r[0]),d.text(r[1]),t.updateTextarea(),n.length&&(t.updateInnerTextarea(!1,n),t.updateTextarea()),t.do_history_snapshot(0))},a.AviaBuilder.shortcodes.addCell=function(e,t){a.AviaBuilder.layoutRow.modifyCellCount(e,t,0)},a.AviaBuilder.shortcodes.removeCell=function(e,t){a.AviaBuilder.layoutRow.modifyCellCount(e,t,-2)},a.AviaBuilder.shortcodes.recalcCell=function(e,t){a.AviaBuilder.layoutRow.modifyCellCount(e,t,-1)},a.AviaBuilder.shortcodes.setCellSize=function(e,t){a.AviaBuilder.layoutRow.setCellSize(e,t)},a.AviaBuilder.layoutRow={cellSize:[["av_cell_one_full","1/1",1],["av_cell_four_fifth","4/5",.8],["av_cell_three_fourth","3/4",.75],["av_cell_two_third","2/3",.66],["av_cell_three_fifth","3/5",.6],["av_cell_one_half","1/2",.5],["av_cell_two_fifth","2/5",.4],["av_cell_one_third","1/3",.33],["av_cell_one_fourth","1/4",.25],["av_cell_one_fifth","1/5",.2]],newCellOrder:[["av_cell_one_full","1/1"],["av_cell_one_half","1/2"],["av_cell_one_third","1/3"],["av_cell_one_fourth","1/4"],["av_cell_one_fifth","1/5"]],cellSizeVariations:{4:{1:["av_cell_one_fourth","av_cell_one_fourth","av_cell_one_fourth","av_cell_one_fourth"],2:["av_cell_one_fifth","av_cell_one_fifth","av_cell_one_fifth","av_cell_two_fifth"],3:["av_cell_one_fifth","av_cell_one_fifth","av_cell_two_fifth","av_cell_one_fifth"],4:["av_cell_one_fifth","av_cell_two_fifth","av_cell_one_fifth","av_cell_one_fifth"],5:["av_cell_two_fifth","av_cell_one_fifth","av_cell_one_fifth","av_cell_one_fifth"]},3:{1:["av_cell_one_third","av_cell_one_third","av_cell_one_third"],2:["av_cell_one_fourth","av_cell_one_fourth","av_cell_one_half"],3:["av_cell_one_fourth","av_cell_one_half","av_cell_one_fourth"],4:["av_cell_one_half","av_cell_one_fourth","av_cell_one_fourth"],5:["av_cell_one_fifth","av_cell_one_fifth","av_cell_three_fifth"],6:["av_cell_one_fifth","av_cell_three_fifth","av_cell_one_fifth"],7:["av_cell_three_fifth","av_cell_one_fifth","av_cell_one_fifth"],8:["av_cell_one_fifth","av_cell_two_fifth","av_cell_two_fifth"],9:["av_cell_two_fifth","av_cell_one_fifth","av_cell_two_fifth"],10:["av_cell_two_fifth","av_cell_two_fifth","av_cell_one_fifth"]},2:{1:["av_cell_one_half","av_cell_one_half"],2:["av_cell_two_third","av_cell_one_third"],3:["av_cell_one_third","av_cell_two_third"],4:["av_cell_one_fourth","av_cell_three_fourth"],5:["av_cell_three_fourth","av_cell_one_fourth"],6:["av_cell_one_fifth","av_cell_four_fifth"],7:["av_cell_four_fifth","av_cell_one_fifth"],8:["av_cell_two_fifth","av_cell_three_fifth"],9:["av_cell_three_fifth","av_cell_two_fifth"]}},modifyCellCount:function(e,t,o){var i=a(e).parents(".avia_layout_row").eq(0),n=i.find(".avia_layout_cell"),l=n.length+o,r=a.AviaBuilder.layoutRow.newCellOrder[l];void 0!==r&&(l!=n.length?a.AviaBuilder.layoutRow.changeMultipleCellSize(n,r,t):(a.AviaBuilder.layoutRow.changeMultipleCellSize(n,r,t),a.AviaBuilder.layoutRow.insertCell(i,r,t),t.activate_element_dropping()),t.updateInnerTextarea(!1,i),t.updateTextarea(),t.do_history_snapshot(0))},insertCell:function(e,t,o){var i=e.find("> .avia_inner_shortcode"),n=t[0].replace("av_cell_","avia_sc_cell_").replace("_one_full",""),l=a(a("#avia-tmpl-"+n).html());i.append(l)},changeMultipleCellSize:function(e,t,o,i){var n=t,l="";e.each((function(e){if(i)for(var r in l=t[e],a.AviaBuilder.layoutRow.cellSize)l==a.AviaBuilder.layoutRow.cellSize[r][0]&&(n=a.AviaBuilder.layoutRow.cellSize[r]);a.AviaBuilder.layoutRow.changeSingleCellSize(a(this),n,o)}))},changeSingleCellSize:function(a,e,t){var o=a.find("> .avia_sorthandle > .avia-col-size"),i=a.data("width"),n=a.find("> .avia_inner_shortcode > "+t.datastorage),l=n.val();l=(l=l.replace(new RegExp("^\\["+i,"g"),"["+e[0])).replace(new RegExp(i+"\\]","g"),e[0]+"]"),n.val(l),a.removeClass(i).addClass(e[0]),a.attr("data-width",e[0]).data("width",e[0]),a.attr("data-shortcodehandler",e[0]).data("shortcodehandler",e[0]),a.attr("data-allowed-shortcodes",e[0]).data("allowed-shortcodes",e[0]),o.text(e[1])},setCellSize:function(e,t){var o=a(e).parents(".avia_layout_row").eq(0),i=o.find(".avia_layout_cell"),n=i.length,l=this.cellSizeVariations[n],r="",s="",d="",_="highscreen";if(l){for(var c in r+="<form>",l){for(var v in s="",d="",l[c]){for(var u in this.cellSize)this.cellSize[u][0]==l[c][v]&&(d=this.cellSize[u][1]);s+="<span class='av-modal-label-"+l[c][v]+"'>"+d+"</span>"}r+="<div class='avia-layout-row-modal'><label class='avia-layout-row-modal-label'>",r+="<input type='radio' name='layout' value='"+c+"' /><span class='av-layout-row-inner-label'>"+s+"</span></label></div>"}r+="</form>"}else r+="<p>"+avia_modal_L10n.no_layout+"<br/>",r+=1==n?avia_modal_L10n.add_one_cell:avia_modal_L10n.remove_one_cell,r+="</p>",_="flexscreen";new a.AviaModalNotification({msg:r,modal_class:_,modal_title:avia_modal_L10n.select_layout,button:"save",scope:this,on_save:this.saveModal,save_param:{obj:t,variations:l,row:o,all:i}})},saveModal:function(e,t){var o=!(!e||!e.layout)&&e.layout;o&&(a.AviaBuilder.layoutRow.changeMultipleCellSize(t.all,t.variations[o],t.obj,!0),t.obj.updateInnerTextarea(!1,t.row),t.obj.updateTextarea(),t.obj.do_history_snapshot(0))}}}(jQuery);